<!DOCTYPE html>
<html lang="en">

<head>
    <title>Log Entry</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link href="/static/css/logstyle.css" rel="stylesheet">
    <link rel="shortcut icon" href="/static/favicon.ico">
</head>
<body>

<br>
<div class="info">
    <div class="info__guild-icon-container">
        <img class="info__guild-icon" src="{{ log_entry.recipient.avatar_url }}" onerror="this.src='{{ log_entry.recipient.default_avatar_url }}'"/>
    </div>
    <div class="info__metadata">
        <div class="info__guild-name">Thread Logs {% if log_entry.open %}(Open){% else %}(Closed){% endif %}</div>
        <div class="info__channel-name">Recipient: <strong>{{log_entry.recipient.name | e }}</strong>#{{ log_entry.recipient.discriminator }} - <small><code>{{ log_entry.recipient.id }}</code></small></div>
        {% if log_entry.recipient != log_entry.creator %}
        <div class="info__channel-topic">Creator: <strong>{{log_entry.creator.name | e}}</strong>#{{ log_entry.creator.discriminator }} - <small><code>{{ log_entry.creator.id }}</code></small></div>
        {% else %}
        {% endif %}

        <div class="info__channel-message-count">{{ log_entry.messages | length }} messages </div>
    </div>
</div>

<div class="chatlog">
    {% for group in log_entry.message_groups %}
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="{{ group.author.avatar_url }}" onerror="this.src='{{ group.author.default_avatar_url }}'" />
            </div>  
                     
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="{{ group.author | string | e }}">{{ group.author.name}}</span>{% if group.author.mod %}<span class="mod-tag">Mod</span> {% else %}{% endif %}
                <span class="chatlog__timestamp">{{ group.created_at }}</span>
                {% for message in group.messages %} 
                    {% if message.content %}
                        <div class="chatlog__content">
                            {{ message.content | e }}
                        </div>
                    {% endif %}

                    {% for attachment in message.attachments %}
                        <div class="chatlog__attachment">
                            <a href="{{ attachment }}">
                                <img class="chatlog__attachment-thumbnail" src="{{ attachment }}" />
                            </a>
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
    {% endfor %}

    {% if not log_entry.open %}
        <div class="chatlog__message-group">
            <div class="chatlog__author-avatar-container">
                <img class="chatlog__author-avatar" src="{{ log_entry.system_avatar_url }}" />
            </div>
            <div class="chatlog__messages">
                <span class="chatlog__author-name" title="{{ log_entry.closer | string | e }}">{{ log_entry.closer.name}}</span>{% if log_entry.closer.mod %}
                <span>Closed the thread.</span><span class="system-tag">System</span> {% else %}{% endif %}
                <span class="chatlog__timestamp">{{ log_entry.human_closed_at }}</span>
            </div>
        </div> 
    {% else %}
    {% endif %}
</div>

</body>
</html>